<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Editor</title>

  <style type="text/css" media="screen">
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    body {
      background-color: #1a1a1a;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      position: relative;
    }

    /* üåë Capa oscura con blur */
    body::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, 0.35);
      backdrop-filter: blur(6px);
      z-index: 0;
    }

    #editor {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      background: transparent !important;
      z-index: 1;
      font-family: Consolas, 'Microsoft YaHei UI', monospace;
    }

    /* üé® Scrollbars personalizados y visibles */
    .ace_scrollbar-v, .ace_scrollbar-h {
      background: #2b2b2b !important; /* Track */
    }

    .ace_scrollbar-inner {
      background: #5c5c5c !important; /* Thumb */
      border-radius: 6px !important;
      transition: background 0.25s ease;
    }

    .ace_scrollbar-inner:hover {
      background: #9c9c9c !important;
    }

    /* ‚ú® Mejoras visuales para el Ace Editor */
    .ace_marker-layer .ace_active-line {
      background-color: rgba(255, 255, 255, 0.08) !important;
    }

    .ace_gutter {
      background: rgba(0, 0, 0, 0.25) !important;
      color: rgba(200, 200, 200, 0.65) !important;
      border-right: 1px solid rgba(255, 255, 255, 0.05);
    }

    .ace_cursor {
      border-left: 2px solid #f8f8f2 !important;
    }

    /* üö´ FIX: eliminar l√≠nea superior sin mover scrollbars */
    .ace_scroller,
    .ace_content,
    .ace_gutter {
      top: 0 !important;
      margin-top: 0 !important;
      padding-top: 0 !important;
      border-top: none !important;
      box-shadow: none !important;
    }

    /* üß© Mantener las barras donde deben estar */
    .ace_scrollbar-h {
      bottom: 0 !important;
      top: auto !important;
    }

    .ace_scrollbar-v {
      right: 0 !important;
      top: 0 !important;
    }

    #editor {
      border-top: none !important;
      margin-top: 0 !important;
      padding-top: 0 !important;
    }
  </style>

  <script src="ace/ace.js" type="text/javascript"></script>
  <script src="ace/ext-language_tools.js"></script>
</head>

<body>
  <pre id="editor"></pre>

  <script>
        var GetText;
        var SetText;
        var ClearText;
        var SetTheme;
    
    // üåÜ Buscar autom√°ticamente una imagen local (jpg, png o gif)
    (function setBackgroundImage() {
      const possibleImages = ["image.jpg", "image.png", "image.gif"];
      for (const imgFile of possibleImages) {
        const img = new Image();
        img.onload = () => document.body.style.backgroundImage = `url('${imgFile}')`;
        img.src = imgFile;
      }
    })();

    // üé® Configuraci√≥n base del editor ACE
    ace.require("ace/ext/language_tools");
    const editor = ace.edit("editor");
    editor.setTheme("ace/theme/tomorrow_night_eighties");
    editor.session.setMode("ace/mode/lua");
    editor.setOption("enableLiveAutocompletion", true);
    editor.setOption("cursorStyle", "smooth");
    editor.setShowPrintMargin(false);
    editor.setHighlightActiveLine(true);
    editor.setOption("scrollPastEnd", 1);
    editor.renderer.setScrollMargin(0, 0, 0, 0);
    editor.setOptions({
      fontSize: "13px",
      useSoftTabs: true,
      tabSize: 2,
    });

    // üí™ Fuerza scrollbars visibles
    const forceScrollbars = () => {
      const r = editor.renderer;
      if (r.scrollBarV) r.scrollBarV.element.style.display = "block";
      if (r.scrollBarH) r.scrollBarH.element.style.display = "block";
    };
    setInterval(forceScrollbars, 500);


    // üåç Funciones globales accesibles desde C# o externo
            GetText = function()
        {
            return editor.getValue();
        }

        SetText = function(x)
        {
          editor.setValue(x);
          editor.session.setValue(x);
        }

        ClearText = function()
        {
          editor.setValue("");
        }

        SetTheme = function(theme) {
        editor.setTheme("ace/theme/" + theme);
        };

        document.oncontextmenu = function()
        {
          return false;
        }
    window.SetTheme = function (theme) { editor.setTheme("ace/theme/" + theme); };

    // üö´ Deshabilitar clic derecho
    document.oncontextmenu = function () { return false; };
  </script>
</body>
</html>
